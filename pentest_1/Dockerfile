#------------------------------------------------------------------------------
#    Preparation d'outils de pentesting pour formation 
#    complete en cybersécurité.
#    LECOMTE Cyril <cyrhades76@gmail.com>
#------------------------------------------------------------------------------
FROM alpine:latest

MAINTAINER LECOMTE Cyril <cyrhades76@gmail.com>
LABEL author.lastname="LECOMTE" author.firstname="Cyril"

ENV GROUP hackoeil
ENV USER student
ENV PASSWORD pentest
ENV HOME /home/${USER}

# Creation de l'utilisateur
RUN addgroup -S ${GROUP} && adduser -S ${USER} -G ${GROUP} -h ${HOME} 
#RUN echo ${PASSWORD} | passwd ${USER} --stdin
RUN echo "${USER}:${PASSWORD}" | chpasswd

# Installation de dependances (Gzip, git, nano, etc...)
RUN set -xe && apk update && apk add sudo gzip zlib openssl git nano curl
RUN apk add apr-dev apr-util-dev bash build-base coreutils jq libidn 
RUN apk add libidn-dev libpq libssh libssh-dev mariadb-connector-c mariadb-connector-c-dev mariadb-dev 
RUN apk add ncurses ncurses-dev parallel pcre pcre-dev postgresql-dev subversion-dev subversion-libs tar tmux && parallel --will-cite

# Ajout des fonts nécessaires
RUN apk add terminus-font font-noto font-noto-extra font-arabic-misc 
RUN apk add font-misc-cyrillic font-mutt-misc font-screen-cyrillic font-winitzki-cyrillic font-cronyx-cyrillic
RUN apk add font-noto-arabic font-noto-armenian font-noto-cherokee font-noto-devanagari font-noto-ethiopic font-noto-georgian
RUN apk add font-noto-hebrew font-noto-lao font-noto-malayalam font-noto-tamil font-noto-thaana font-noto-thai

# Installation de ghex (editeur hexa decimal) et de mysql-client
RUN apk add ghex mysql-client

# Installation de PYTHON et PIP
ENV PYTHONUNBUFFERED=1
RUN apk add --update --no-cache python3 && ln -sf python3 /usr/bin/python
RUN python3 -m ensurepip
RUN pip3 install --no-cache --upgrade pip setuptools

# Installation de PHP et Composer
RUN apk add php php-cli php-fpm php-json php-common php-zip php-gd php-mbstring php-curl php-xml php-pear php-bcmath

# Installation NODE et NPM
RUN apk add nodejs npm

# Installation de SqlMap
RUN git clone --depth 1 https://github.com/sqlmapproject/sqlmap.git ${HOME}/sqlmap
RUN echo 'alias sqlmap="${HOME}/sqlmap/sqlmap.py"' >> ${HOME}/.bashrc

# Téléchargement de thc-hydra (brute forceur)
RUN git clone https://github.com/vanhauser-thc/thc-hydra/ ${HOME}/thc-hydra/
# compiler thc-hydra
RUN cd ${HOME}/thc-hydra && ./configure && make && make install

# Installation de netcat
RUN apk add --update --no-cache netcat-openbsd

# Installation de hashcat (disponible uniquement sur la branche edge actuellement)
RUN echo "@edge http://dl-cdn.alpinelinux.org/alpine/edge/testing" >> /etc/apk/repositories
RUN apk add hashcat@edge

# Installation de nmap
RUN apk add nmap

# Ajout de la wordlist rockyou
RUN mkdir /usr/share/wordlists
RUN curl https://raw.githubusercontent.com/Cyrhades/Security/main/wordlists/rockyou.txt.gz -o /usr/share/wordlists/rockyou.txt.gz
RUN gzip -d /usr/share/wordlists/rockyou.txt.gz


# Exposition des ports (http, https, netcat, ...)
EXPOSE 80 443 1234

# Utilisation de l'utilisateur
USER ${USER}

# On se place dans notre répertoire de travail
WORKDIR ${HOME}